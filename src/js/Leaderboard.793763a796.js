import store from"./store.ee6177fdcf.js";import{resultTemplate,skeletonTemplate}from"./templates.a66e7640fb.js";export default class LeaderboardResults{constructor(){this.$node=document.querySelector("table"),this.$results=document.querySelector("#content")}sortBy(e){return(t,r)=>null===t.metrics?1:null===r.metrics||t.metrics[e].value<r.metrics[e].value?-1:t.metrics[e].value>r.metrics[e].value?1:0}fetchData(e){e.urls?e.urls=e.urls.map((e=>encodeURIComponent(e))).join(","):e.origins&&(e.origins=e.origins.map((e=>encodeURIComponent(e))).join(","));const t=Object.keys(e).map((t=>t+"="+e[t])).join("&");return fetch(`https://crux.pazguille.me/api/web-vitals?${t}`).then((e=>e.json())).then((e=>{e.code?store.dispatch({type:"LEADERBOARD_LOADED",error:!0}):store.dispatch({type:"LEADERBOARD_LOADED",results:e})})).catch((()=>{store.dispatch({type:"LEADERBOARD_LOADED",error:!0})}))}toggleVisibility(){const{running:e,from:t,urls:r,filters:s,leaderboardLoaded:i,results:o}=store.getState();if(e)return this.fetchData({[t]:r,device:s.device,connection:s.connection}),void this.$node.setAttribute("hidden","hidden");if(i&&o){const e=o.sort(this.sortBy("LCP")).map(((e,t)=>resultTemplate(e,t+=1)));return this.$node.removeAttribute("hidden"),this.$results.innerHTML="",this.$results.insertAdjacentHTML("beforeend",e.join("")),void this.$node.removeAttribute("hidden")}return!1===i&&r.length>0?(this.$node.removeAttribute("hidden"),void this.$results.insertAdjacentHTML("beforeend",skeletonTemplate(r[r.length-1]))):!1===i&&0===r.length?(this.$results.innerHTML="",this.$node.setAttribute("hidden","hidden"),void window.history.replaceState({},"",`${location.pathname}`)):void 0}init(){store.subscribe(this.toggleVisibility.bind(this))}}